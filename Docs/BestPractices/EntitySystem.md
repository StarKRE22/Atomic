# üìå Entity System —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º Model & View

---

## üìñ Overview

–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ **Entity —Å–∏—Å—Ç–µ–º—ã**, –≥–¥–µ **C# –º–æ–¥–µ–ª—å –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç Unity-–æ–∫—Ä—É–∂–µ–Ω–∏—è**, –∞ Unity
–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.

–° –ø–æ–º–æ—â—å—é [Atomic.Entities](../Entities/Manual.md) —ç—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —É–¥–æ–±–Ω–æ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ:

- –Æ–Ω–∏—Ç—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º —Ç–∏–ø–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä `UnitEntity`.
- –Æ–Ω–∏—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ [ScriptableEntityFactory\<E>](../Entities/Factories/ScriptableEntityFactory%601.md) –∏ –±–µ—Ä—É—Ç—Å—è –∏–∑
  –ø—É–ª–∞ [EntityPool\<E>](../Entities/Pooling/EntityPool%601.md).
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è
  —á–µ—Ä–µ–∑ [EntityView\<E>](../Entities/UI/EntityView%601.md), [EntityViewCollection\<E>](../Entities/UI/EntityCollectionView%601.md)
  –∏ [EntityViewPool\<E>](../Entities/UI/EntityViewPool%601.md).

---

## üóÇ –ë–∞–∑–æ–≤—ã–π —Ç–∏–ø —Å—É—â–Ω–æ—Å—Ç–∏

–ë–∞–∑–æ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å –≤ **Atomic.Entities** ‚Äî —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å—Ç—Ä–æ–∏—Ç—Å—è –≤—Å—è —Å–∏—Å—Ç–µ–º–∞ —é–Ω–∏—Ç–æ–≤. –û–Ω–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç
**–¥–∞–Ω–Ω—ã–µ**, **—Ç–µ–≥–∏**, **–∑–Ω–∞—á–µ–Ω–∏—è** –∏ **–ø–æ–≤–µ–¥–µ–Ω–∏—è**, –æ—Å—Ç–∞–≤–∞—è—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–π –∏ –Ω–µ –∑–∞–≤–∏—Å—è –Ω–∞–ø—Ä—è–º—É—é –æ—Ç Unity.

### 1Ô∏è‚É£ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—É—â–Ω–æ—Å—Ç–∏

```csharp
// –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å—É—â–Ω–æ—Å—Ç–∏
public interface IUnitEntity : IEntity
{
}
```

**–ü–æ—è—Å–Ω–µ–Ω–∏—è:**

- `IUnitEntity` –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç `IEntity` ‚Äî –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ AtomArch.
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–ª—É–∂–∏—Ç **—Ç–æ—á–∫–æ–π —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**: —á–µ—Ä–µ–∑ –Ω–µ–≥–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –º–µ—Ç–æ–¥—ã –∏ —Å–≤–æ–π—Å—Ç–≤–∞, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è —é–Ω–∏—Ç–æ–≤, –Ω–µ –º–µ–Ω—è—è
  –±–∞–∑–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

### 2Ô∏è‚É£ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è UnitEntity

```csharp
public sealed class UnitEntity : Entity, IUnitEntity
{
    public UnitEntity(
        string name = null,
        int tagCapacity = 0,
        int valueCapacity = 0,
        int behaviourCapacity = 0
    ) : base(name, tagCapacity, valueCapacity, behaviourCapacity)
    {
    }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–∏—è:**

- –ù–∞—Å–ª–µ–¥—É–µ–º—Å—è –æ—Ç `Entity` ‚Äî –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–µ–≥–æ–≤, –∑–Ω–∞—á–µ–Ω–∏–π –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è.
- **Capacity-based –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä** –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞—Ä–∞–Ω–µ–µ –≤—ã–¥–µ–ª—è—Ç—å –ø–∞–º—è—Ç—å –ø–æ–¥ —Ç–µ–≥–∏, –∑–Ω–∞—á–µ–Ω–∏—è –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è, —á—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç
  –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∏ –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ —é–Ω–∏—Ç–æ–≤.
- `name` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –ø–æ–∏—Å–∫–∞ –≤ –ø—É–ª–∞—Ö –∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö.

> üí° –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –æ—Ç–¥–µ–ª—è–µ—Ç **–ª–æ–≥–∏–∫—É —Å—É—â–Ω–æ—Å—Ç–∏** –æ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ Unity, –æ–±–ª–µ–≥—á–∞—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏
> —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã.
---

## üè≠ –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–∏

–§–∞–±—Ä–∏–∫–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **—Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å—É—â–Ω–æ—Å—Ç–µ–π**. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
—é–Ω–∏—Ç–∞, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –ø–æ–¥–∫–ª—é—á–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏ —Ç–µ–≥–∏. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–º,
–ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º –∏ —É–¥–æ–±–Ω—ã–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**.

### 1Ô∏è‚É£ –ë–∞–∑–æ–≤–∞—è —Ñ–∞–±—Ä–∏–∫–∞ UnitFactory

```csharp
public abstract class UnitFactory : ScriptableEntityFactory<IUnitEntity>
{
    public string Name => this.name;

    public sealed override IUnitEntity Create()
    {
        var entity = new UnitEntity(
            this.Name,
            this.initialTagCapacity,
            this.initialValueCapacity,
            this.initialBehaviourCapacity
        );
        this.Install(entity);
        return entity;
    }

    protected abstract void Install(IUnitEntity entity);
}
```

**–ü–æ—è—Å–Ω–µ–Ω–∏—è:**

- –ù–∞—Å–ª–µ–¥—É–µ–º—Å—è –æ—Ç `ScriptableEntityFactory<IUnitEntity>` ‚Äî –±–∞–∑–æ–≤–∞—è —Ñ–∞–±—Ä–∏–∫–∞ –¥–ª—è ScriptableObject, —Å–æ–∑–¥–∞—é—â–µ–≥–æ —Å—É—â–Ω–æ—Å—Ç–∏.
- `Create()` —Å–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä `UnitEntity` —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ capacity –∏ –∏–º–µ–Ω–µ–º.
- –ú–µ—Ç–æ–¥ `Install()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—É—â–Ω–æ—Å—Ç–∏**: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–æ–≤, –∑–Ω–∞—á–µ–Ω–∏–π, –ø–æ–≤–µ–¥–µ–Ω–∏—è. –û–Ω
  –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π, —á—Ç–æ–±—ã –∫–∞–∂–¥–∞—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ñ–∞–±—Ä–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∞ —Å–≤–æ—é –ª–æ–≥–∏–∫—É.
- –°–≤–æ–π—Å—Ç–≤–æ `Name` —É–¥–æ–±–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π.

---

### 2Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ–∞–±—Ä–∏–∫

#### üîπ –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Ç–∞–Ω–∫–∞

```csharp
[CreateAssetMenu(
    fileName = "TankFactory", 
    menuName = "Example/New TankFactory" 
)]
public sealed class TankFactory : UnitFactory
{
    [SerializeField] private TransformEntityInstaller _transformInstaller;
    [SerializeField] private MoveEntityInstaller _moveInstaller;
    [SerializeField] private LifeEntityInstaller _lifeInstaller;
    [SerializeField] private RangeCombatEntityInstaller _combatInstaller;
    [SerializeField] private AIEntityInstaller _aiInstaller;

    protected override void Install(IUnitEntity entity)
    {
        entity.AddUnitTag(); // –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–≥ "Unit"
        entity.AddTeam(new ReactiveVariable<TeamType>()); // –∫–æ–º–∞–Ω–¥–∞

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ EntityInstallers
        entity.Install(_transformInstaller);
        entity.Install(_moveInstaller);
        entity.Install(_lifeInstaller);
        entity.Install(_combatInstaller);
        entity.Install(_aiInstaller);
    }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–∏—è:**

- –§–∞–±—Ä–∏–∫–∞ —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–Ω–∫–∞ –∏ —Å—Ä–∞–∑—É –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –¥–≤–∏–∂–µ–Ω–∏–µ, –∂–∏–∑–Ω—å, –±–æ–π, AI –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **EntityInstallers** —É–ø—Ä–æ—â–∞–µ—Ç –º–æ–¥—É–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫ —Å—É—â–Ω–æ—Å—Ç–∏.

#### üîπ –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–ª–¥–∞—Ç–∏–∫–∞

```csharp
[CreateAssetMenu(
    fileName = "SoliderFactory", 
    menuName = "Example/New SoliderFactory" 
)]
public sealed class SoliderFactory : UnitFactory
{
    [SerializeField] private TransformEntityInstaller _transformInstaller;
    [SerializeField] private MoveEntityInstaller _moveInstaller;
    [SerializeField] private LifeEntityInstaller _lifeInstaller;
    [SerializeField] private MeleeCombatEntityInstaller _meleeCombatInstaller;
    [SerializeField] private AIEntityInstaller _aiInstaller;

    protected override void Install(IUnitEntity entity)
    {
        entity.AddUnitTag();
        entity.AddTeam(new ReactiveVariable<TeamType>());

        entity.Install(_transformInstaller);
        entity.Install(_moveInstaller);
        entity.Install(_lifeInstaller);
        entity.Install(_meleeCombatInstaller);
        entity.Install(_aiInstaller);
    }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–∏—è:**

- –ü–æ–¥–æ–±–Ω–æ —Ñ–∞–±—Ä–∏–∫–µ —Ç–∞–Ω–∫–∞, –Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç **–±–ª–∏–∂–Ω–∏–π –±–æ–π** (`MeleeCombatEntityInstaller`) –≤–º–µ—Å—Ç–æ –¥–∞–ª—å–Ω–µ–≥–æ.
- –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —é–Ω–∏—Ç–æ–≤ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ–¥–∞.

---

### üîß –°–æ–∑–¥–∞–Ω–∏–µ –∞—Å—Å–µ—Ç–æ–≤ —Ñ–∞–±—Ä–∏–∫ –≤ Unity

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–±—Ä–∏–∫ –≤ –ø—Ä–æ–µ–∫—Ç–µ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∞—Å—Å–µ—Ç—ã —á–µ—Ä–µ–∑ `Create > Example > New TankFactory / New SoliderFactory`.  
–≠—Ç–∏ –∞—Å—Å–µ—Ç—ã –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è **–º—É–ª—å—Ç–∏—Ñ–∞–±—Ä–∏–∫–∏ –∏ –ø—É–ª–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π**.

<img src="../Images/UnitsFactories.png" alt="Inspector setup example" width="200">

> üí° –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —é–Ω–∏—Ç–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è—è
> –Ω–æ–≤—ã–µ —Ñ–∞–±—Ä–∏–∫–∏.

---

## üóÇ –ú—É–ª—å—Ç–∏-–§–∞–±—Ä–∏–∫–∞

–ú—É–ª—å—Ç–∏-—Ñ–∞–±—Ä–∏–∫–∞ —Å–ª—É–∂–∏—Ç **–∫–∞—Ç–∞–ª–æ–≥–æ–º –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–±—Ä–∏–∫ —é–Ω–∏—Ç–æ–≤**, –ø–æ–∑–≤–æ–ª—è—è –±—ã—Å—Ç—Ä–æ –∏—Å–∫–∞—Ç—å –Ω—É–∂–Ω—É—é —Ñ–∞–±—Ä–∏–∫—É –ø–æ –∫–ª—é—á—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ
–∏–º–µ–Ω–∏ —é–Ω–∏—Ç–∞). –û–Ω–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–±—Ä–∏–∫ –≤ –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

---

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```
csharp
[CreateAssetMenu(fileName = "UnitCatalog", menuName = "Example/New UnitCatalog")]
public sealed class UnitMultiFactory : ScriptableMultiEntityFactory<string, IUnitEntity, UnitFactory>
{
protected override string GetKey(UnitFactory factory) => factory.Name;
}
```

**–ü–æ—è—Å–Ω–µ–Ω–∏—è:**

- –ù–∞—Å–ª–µ–¥—É–µ–º—Å—è –æ—Ç `ScriptableMultiEntityFactory<TKey, TEntity, TFactory>` ‚Äî —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–±—Ä–∏–∫ –≤
  –æ–¥–Ω–æ–º ScriptableObject**.
- `GetKey` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∞–±—Ä–∏–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Name`), –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏
  –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Å—É—â–Ω–æ—Å—Ç–∏ –∏–∑ –ø—É–ª–∞.
- –° –ø–æ–º–æ—â—å—é –º—É–ª—å—Ç–∏-—Ñ–∞–±—Ä–∏–∫–∏ –ª–µ–≥–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —é–Ω–∏—Ç–æ–≤ –≤ –∏–≥—Ä–µ, –¥–æ–±–∞–≤–ª—è—è –Ω–æ–≤—ã–µ —Ñ–∞–±—Ä–∏–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.

---

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Unity

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –º—É–ª—å—Ç–∏-—Ñ–∞–±—Ä–∏–∫–∏ –≤—Å–µ –≤–∞—à–∏ —Ñ–∞–±—Ä–∏–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥ —á–µ—Ä–µ–∑ Inspector:

<img src="../Images/UnitCatalog.png" alt="Inspector setup example" width="400">

> üí° –ö–∞—Ç–∞–ª–æ–≥ –º—É–ª—å—Ç–∏-—Ñ–∞–±—Ä–∏–∫ –æ–±–ª–µ–≥—á–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–∏–ø–æ–≤ —é–Ω–∏—Ç–æ–≤, –¥–µ–ª–∞—è —Å–∏—Å—Ç–µ–º—É **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–π –∏ —É–¥–æ–±–Ω–æ–π
–¥–ª—è –¥–∏–∑–∞–π–Ω–µ—Ä–æ–≤**.

---

## üèó –†–∞–∑–≤–µ—Ä—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Å—É—â–Ω–æ—Å—Ç–µ–π

–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è **–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —é–Ω–∏—Ç–æ–≤** —á–µ—Ä–µ–∑ `GameContext`. –ó–¥–µ—Å—å –º—ã —Å–æ–∑–¥–∞–µ–º –ø—É–ª
—Å—É—â–Ω–æ—Å—Ç–µ–π, –º–∏—Ä –¥–ª—è –∏—Ö —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–≥—Ä—ã.

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```csharp
[Serializable]
public sealed class UnitSystemInstaller : IEntityInstaller<IGameContext>
{
    [SerializeField] 
    private UnitMultiFactory factoryCatalog;

    public void Install(IGameContext context)
    {
        // 1Ô∏è‚É£ –°–æ–∑–¥–∞–µ–º –º—É–ª—å—Ç–∏–ø—É–ª –¥–ª—è —é–Ω–∏—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—è –Ω–∞—à –∫–∞—Ç–∞–ª–æ–≥ —Ñ–∞–±—Ä–∏–∫
        var entityPool = new MultiEntityPool<string, IUnitEntity>(factoryCatalog);
        context.AddEntityPool(entityPool);

        // 2Ô∏è‚É£ –°–æ–∑–¥–∞–µ–º –º–∏—Ä –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
        var entityWorld = new EntityWorld<IUnitEntity>();
        context.AddEntityWorld(entityWorld);

        // 3Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–∞–µ–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –º–∏—Ä–∞ –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∏–≥—Ä—ã
        context.WhenInit(entityWorld.InitEntities);
        context.WhenEnable(entityWorld.Enable);
        context.WhenTick(entityWorld.Tick);
        context.WhenFixedTick(entityWorld.FixedTick);
        context.WhenLateTick(entityWorld.LateTick);
        context.WhenDisable(entityWorld.Disable);
        context.WhenDispose(entityWorld.DisposeEntities);
        context.WhenDispose(entityWorld.Dispose);
    }
}
```

---

### –ü–æ—è—Å–Ω–µ–Ω–∏—è:

- **MultiEntityPool** ‚Äî –ø—É–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ —é–Ω–∏—Ç–æ–≤, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã—Ö —Ñ–∞–±—Ä–∏–∫–∞–º–∏. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
  –æ–±—ä–µ–∫—Ç—ã, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è –∞–ª–ª–æ–∫–∞—Ü–∏–∏.
- **EntityWorld** ‚Äî —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π: –∏—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ–º.
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–≥—Ä—ã (`IGameContext`)** ‚Äî —Å–≤—è–∑—ã–≤–∞–µ—Ç –º–∏—Ä –∏ –ø—É–ª —Å –∏–≥—Ä–æ–≤—ã–º —Ü–∏–∫–ª–æ–º, –ø–æ–¥–ø–∏—Å—ã–≤–∞—è –º–µ—Ç–æ–¥—ã `Init`, `Enable`, `Tick`,
  `FixedTick`, `LateTick`, `Disable` –∏ `Dispose` –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è –∏–≥—Ä—ã.
- –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–ø–æ–ª–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ C# –ª–æ–≥–∏–∫–∏ –∏ Unity-–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏**, –ø–æ–∑–≤–æ–ª—è—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∏
  –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —é–Ω–∏—Ç–æ–≤.

---

## ‚ö° –°–ø–∞–≤–Ω –∏ –¥–µ—Å–ø–∞—É–Ω —Å—É—â–Ω–æ—Å—Ç–µ–π

–û–¥–Ω–∏–º –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã —è–≤–ª—è–µ—Ç—Å—è **—Å–ø–∞—É–Ω –∏ –¥–µ—Å–ø–∞—É–Ω —Å—É—â–Ω–æ—Å—Ç–µ–π**. –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:  
–±–µ—Ä–µ–º —Å—É—â–Ω–æ—Å—Ç—å –∏–∑ –ø—É–ª–∞, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –µ—ë —Å–≤–æ–π—Å—Ç–≤–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ `EntityWorld`. –ü—Ä–∏ —ç—Ç–æ–º:

- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è `Entity.Init()` –∏ `Entity.Enable()`.
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ –º–∏—Ä–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `Entity.Disable()`.
- –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `Update`/`FixedUpdate` –∏ –¥—Ä—É–≥–∏–µ —Ü–∏–∫–ª—ã `EntityWorld`.

---

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```csharp
public static class UnitsUseCase
{
    public static IUnitEntity Spawn(
        IGameContext context,
        string name,
        Vector3 position,
        Quaternion rotation,
        TeamType team
    )
    {
        // –ë–µ—Ä–µ–º —Å—É—â–Ω–æ—Å—Ç—å –∏–∑ –ø—É–ª–∞ –ø–æ –∏–º–µ–Ω–∏
        var pool = context.GetEntityPool();
        var entity = pool.Rent(name);

        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ, –ø–æ–≤–æ—Ä–æ—Ç –∏ –∫–æ–º–∞–Ω–¥—É
        entity.GetPosition().Value = position;
        entity.GetRotation().Value = rotation;
        entity.GetTeam().Value = team;

        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∏—Ä, –≥–¥–µ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è
        context.GetEntityWorld().Add(entity);
        return entity;
    }
    
    public static bool Despawn(IGameContext context, IUnitEntity entity)
    {
        // –£–±–∏—Ä–∞–µ–º –∏–∑ –º–∏—Ä–∞
        if (!context.GetEntityWorld().Remove(entity))
            return false;

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –ø—É–ª –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        context.GetEntityPool().Return(entity);
        return true;
    }
}
```

---

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```csharp
// –°–ø–∞–≤–Ω —é–Ω–∏—Ç–∞ –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
UnitsUseCase.Spawn(context, "Builder", position, rotation, TeamType.Player);

// –î–µ—Å–ø–∞—É–Ω —é–Ω–∏—Ç–∞ –ø—Ä–∏ –µ–≥–æ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏
UnitsUseCase.Despawn(context, unitEntity);
```

---

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π

–†–∞–∑–¥–µ–ª –ø–æ—Å–≤—è—â—ë–Ω –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —é–Ω–∏—Ç–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ. –ó–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º **EntityView**,  
**EntityViewCatalog**, **EntityViewPool** –∏ **EntityCollectionView** –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏
–æ–±—ä–µ–∫—Ç–æ–≤.

---

### üóÇ –ë–∞–∑–æ–≤—ã–π —Ç–∏–ø –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

–°–æ–∑–¥–∞–¥–∏–º –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —é–Ω–∏—Ç–∞, –Ω–∞—Å–ª–µ–¥—É–µ–º—ã–π –æ—Ç `EntityView<IUnitEntity>`:

```csharp
public class UnitView : EntityView<IUnitEntity>
{
}
```

> üí° –≠—Ç–æ—Ç –∫–ª–∞—Å—Å —Å–≤—è–∑—ã–≤–∞–µ—Ç **C# –º–æ–¥–µ–ª—å** (`IUnitEntity`) —Å –≤–∏–∑—É–∞–ª—å–Ω–æ–π —á–∞—Å—Ç—å—é –≤ Unity.

---

### üè∑ –ö–∞—Ç–∞–ª–æ–≥ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

–î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π —Å–æ–∑–¥–∞—ë–º –∫–∞—Ç–∞–ª–æ–≥, –Ω–∞—Å–ª–µ–¥—É—è `EntityViewCatalog`:

```csharp
using Atomic.Entities;
[CreateAssetMenu(
    fileName = "UnitViewCatalog",
    menuName = "Example/New UnitViewCatalog"
)]
public sealed class UnitViewCatalog : EntityViewCatalog<IUnitEntity, UnitView>
{
}
```

> üí° –ö–∞—Ç–∞–ª–æ–≥ –ø–æ–∑–≤–æ–ª—è–µ—Ç **–ø–æ –∫–ª—é—á—É –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç** –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–∏.

---

### üèó –ü—É–ª –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

–ß—Ç–æ–±—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏, —Å–æ–∑–¥–∞—ë–º –ø—É–ª:

```csharp
public sealed class UnitViewPool : EntityViewPool<IUnitEntity, UnitView>
{
}
```

> üí° `EntityViewPool` –ø–æ–∑–≤–æ–ª—è–µ—Ç **–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã**, –∏–∑–±–µ–≥–∞—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è GameObject-–æ–≤,
> —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è RTS –∏–ª–∏ –º–∞—Å—Å–æ–≤—ã—Ö —Å—Ü–µ–Ω.

---

### üì¶ –ö–æ–ª–ª–µ–∫—Ü–∏—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π —é–Ω–∏—Ç–æ–≤ –∏ –∏—Ö –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `EntityCollectionView`:

```csharp
public sealed class UnitCollectionView : EntityCollectionView<IUnitEntity, UnitView>
{
}
```

> ‚ö° –ö–æ–ª–ª–µ–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã —Å—Ü–µ–Ω—ã —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏, –¥–æ–±–∞–≤–ª—è–µ–º—ã–º–∏ –∏–ª–∏ —É–¥–∞–ª—è–µ–º—ã–º–∏ –∏–∑ `EntityWorld`.

---

## ‚úÖ –ò—Ç–æ–≥

–ò—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—é:

- `EntityView<IUnitEntity>`
- `EntityViewCatalog<IUnitEntity, UnitView>`
- `EntityViewPool<IUnitEntity, UnitView>`
- `EntityCollectionView<IUnitEntity, UnitView>`

–º—ã –ø–æ–ª—É—á–∞–µ–º **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –∏ –º–æ–¥—É–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏**, –∫–æ—Ç–æ—Ä–∞—è:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –∏ –≤–∏–¥.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã —á–µ—Ä–µ–∑ –ø—É–ª.
- –£–ø—Ä–æ—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —é–Ω–∏—Ç–æ–≤ –≤ –∏–≥—Ä–µ.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –∏ –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å `UnitFactory` –∏ `EntityWorld`.

---

## ‚úÖ –í—ã–≤–æ–¥

–ò—Å–ø–æ–ª—å–∑—É—è **Atomic.Entities**, –º—ã –ø–æ–ª—É—á–∞–µ–º:

- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ C# –º–æ–¥–µ–ª–∏ –∏ Unity –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —Å–∏—Å—Ç–µ–º—ã —é–Ω–∏—Ç–æ–≤.
- –ì–∏–±–∫—É—é –∏ –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å **–ø—É–ª–∞–º–∏, —Ñ–∞–±—Ä–∏–∫–∞–º–∏ –∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ EntityView**.
- –ß–∏—Å—Ç—ã–π –∫–æ–¥ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é –æ—Ç Unity API.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —é–Ω–∏—Ç–æ–≤, –∏—Ö –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞.